
  <%#TODO use keysize from settings for csr generation%>
  <%#TODO use keypair from form for csr generation%>
  <%#TODO use values from form for csr generation%>
<%

  key = OpenSSL::PKey::RSA.new 4096
  

  options = { 
    :commonname       => 'www.example.com',
    :organization     => 'Example Corportation',
	:org_unit         => 'IT',
    :location         => 'St. Gallen',
    :state            => 'SG',
    :country          => 'CH',
    :email => 'admin@example.com'
  }
  
  request = OpenSSL::X509::Request.new
  request.version = 0 
  request.subject = OpenSSL::X509::Name.new([
    ['CN',            options[:commonname],   OpenSSL::ASN1::UTF8STRING],
    ['O',             options[:organization], OpenSSL::ASN1::UTF8STRING],
    ['OU',            options[:org_unit],     OpenSSL::ASN1::UTF8STRING],
    ['L',             options[:location],     OpenSSL::ASN1::PRINTABLESTRING],
    ['ST',            options[:state],        OpenSSL::ASN1::PRINTABLESTRING],
    ['C',             options[:country],      OpenSSL::ASN1::PRINTABLESTRING],
    ['emailAddress',  options[:email],        OpenSSL::ASN1::UTF8STRING]
  ])  

  request.public_key = key.public_key
%>

$('#name').val ('Autogenerated CSR: <%= j DateTime.now.to_s(:number) %>');
$('#content').val ('<%= j request.to_pem.html_safe %>');
